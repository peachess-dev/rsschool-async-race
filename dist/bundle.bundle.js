(()=>{"use strict";class e{#e;pageSize;constructor(e,t){this.#e=e,this.pageSize=t}previousPage(){this.#e>1&&this.#e--}nextPage(){this.#e++}get currentPage(){return this.#e}}const t="http://127.0.0.1:3000/garage";async function a(e){let a=t;return e&&(a+=`?${e}`),fetch(a).then((e=>e.json()))}async function n(e){return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).catch((e=>{throw console.error(`Error creating car: ${e}`),e}))}async function r(e){return fetch(`${t}/${e.id}`,{method:"PATCH",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).catch((e=>{throw console.error(`Error updating car: ${e}`),e}))}const c="http://127.0.0.1:3000/engine";function s(e,t){e.status=t,"drive"===t||"started"===t?function(e){const t=document.querySelector(`#car_${e.id} .car-img`),a=t.getBoundingClientRect().width,n=t.querySelector("i"),r=a;let c=null;requestAnimationFrame((function t(s){c||(c=s);const o=s-c,i=e.velocity*a/e.distance,d=Math.min(i*o,r);n.style.marginLeft=`${d}px`,d>=r||requestAnimationFrame(t)}))}(e):"stopped"===t&&o(e)}function o(e){const t=document.querySelector(`#car_${e.id} .car-img`),a=t.querySelector("i");let n=t.getBoundingClientRect().width,r=n,c=e.velocity*n/e.distance;cancelAnimationFrame(e.animationRequestId);const s=r-0*c;a.style.marginLeft=`${s}px`}const i=new class{initLayout(){this.addContainer(),this.addNavigation(),this.addGarageSection(),this.addWinnerSection()}addContainer(){this.container=document.createElement("div"),this.container.className="container",document.body.append(this.container)}addNavigation(){const e=document.createElement("div");e.className="navigation",this.container.append(e);const t=document.createElement("button");t.className="garage_title",t.innerHTML="Garage";const a=document.createElement("button");a.className="winners_title",a.innerHTML="Winners",e.append(t,a),t.addEventListener("click",(()=>this.navigateToView("garage"))),a.addEventListener("click",(()=>this.navigateToView("winners")))}navigateToView(e){const t=document.querySelector(".winners"),a=document.querySelector(".garage"),n=document.querySelector(".garage_title"),r=document.querySelector(".winners_title");switch(e){case"garage":a.classList.add("active"),t.classList.remove("active"),n.classList.add("active"),r.classList.remove("active");break;case"winners":a.classList.remove("active"),t.classList.add("active"),n.classList.remove("active"),r.classList.add("active")}}addGarageSection(){const e=document.createElement("div");e.className="garage";const t=document.createElement("div");t.className="garage__top";const a=document.createElement("div");a.className="garage__top__controls";const n=document.createElement("div");n.className="modify_car",n.id="addCar";const r=document.createElement("input");r.className="modify_car_name";const c=document.createElement("input");c.className="modify_car_color",c.setAttribute("type","color"),c.value="#F5EACD";const s=document.createElement("button");s.id="addCarBtn",s.innerHTML="Add a new car",n.append(r,c,s),a.append(n);const o=document.createElement("div");o.className="modify_car disabled",o.id="updateCar";const i=document.createElement("input");i.className="modify_car_name";const d=document.createElement("input");d.className="modify_car_color",d.setAttribute("type","color"),d.value="#F5EACD";const l=document.createElement("button");l.id="updateCarBtn",l.innerHTML="Update the car",o.append(i,d,l),a.append(o),t.append(a);const m=document.createElement("div");m.className="garage__top__buttons";const u=document.createElement("button");u.id="generateBtn",u.innerHTML="Generate 10 Random Cars";const p=document.createElement("button");p.id="raceBtn",p.innerHTML="Start Race!";const g=document.createElement("button");g.id="resetBtn",g.innerHTML="Reset",m.append(p,g,u),t.append(m),e.append(t);const h=document.createElement("div");h.classList="garage_status";const y=document.createElement("h2");y.className="info";const v=document.createElement("h3");v.className="page_info",h.append(y,v),e.append(h);const E=document.createElement("div");E.classList="garage_cars",e.append(E);const _=document.createElement("div");_.className="garage__bottom";const C=document.createElement("div");C.className="page__bottom__btns";const f=document.createElement("button");f.id="prev_btn";const L=document.createElement("button");L.id="next_btn",f.innerHTML="Previous",L.innerHTML="Next",C.append(f,L),_.append(C),e.append(_),this.container.append(e)}addWinnerSection(){const e=document.createElement("div");e.className="winners",this.container.append(e)}};i.initLayout();const d=new class extends e{constructor(){super(1,7),this.cars=[],this.totalCars=0}async init(){await this.countCars(),await this.fetchCars(),this.renderView()}async countCars(){let e;try{e=await a(),this.totalCars=e.length}catch(e){console.log("Error counting cars",e)}}async fetchCars(){try{const e=new URLSearchParams;e.append("_limit",this.pageSize),e.append("_page",this.currentPage),this.cars=await a(e)}catch(e){console.log("Error fetching cars!",e)}}renderView(){this.displayGarageInfo(),this.displayCars()}async displayGarageInfo(){document.querySelector(".info").innerHTML=`There are ${this.totalCars} cars in your garage`,document.querySelector(".page_info").innerHTML=`You are on page ${this.currentPage}`}displayCars(){this.clearCars(),this.cars.forEach((e=>this.renderCar(e)))}clearCars(){let e=document.querySelector(".garage_cars");e&&(e.innerHTML="")}renderCar(e){let t=document.createElement("div");t.className="car_div",t.id=`car_${e.id}`;let a=document.createElement("div");a.className="car_div__top";let n=document.createElement("h3");n.className="car_name",n.innerHTML=`${e.name}`;let r=document.createElement("button");r.className="car_start",r.innerHTML='<i class="fa-solid fa-play"></i>';let c=document.createElement("button");c.className="car_stop",c.innerHTML='<i class="fa-solid fa-stop"></i>';let s=document.createElement("button");s.className="car_update",s.innerHTML="update";let o=document.createElement("button");o.className="car_remove",o.innerHTML="remove";let i=document.createElement("div");i.className="car_div__body";let d=document.createElement("div");d.className="car-img",d.innerHTML='<i class="fa-solid fa-car-side"></i>',d.style.color=`${e.color}`;let l=document.createElement("div");l.className="car_div__bottom",a.append(n,r,c,s,o),i.append(d),t.append(a,i,l),this.addCarEventListeners(e,t),document.querySelector(".garage_cars").appendChild(t)}addCarEventListeners(e,t){const a=t.querySelector(".car_start"),n=t.querySelector(".car_stop"),c=t.querySelector(".car_update"),i=t.querySelector(".car_remove");a.addEventListener("click",(()=>{s(e,"started"),this.startOrStopCarEngine(e)})),n.addEventListener("click",(()=>{"stopped"!==e.status&&(s(e,"stopped"),this.startOrStopCarEngine(e),o(e))})),c.addEventListener("click",(()=>{r(e)})),i.addEventListener("click",(()=>{this.deleteCar(e),i.dataset.car=JSON.stringify(e)}))}async addCar(e){try{await n(e),this.init()}catch(e){console.log("Error with createCar()",e)}}async updateCar(e){await r(e),this.init()}async deleteCar(e){console.log("remove",e),await async function(e){return fetch(`${t}/${e.id}`,{method:"DELETE"}).then((e=>e.json())).catch((e=>{throw console.error(`Error deleting car: ${e}`),e}))}(e),this.init()}async addRandomCars(){const e=this.generateRandomCars(10);return await Promise.all(e.map((e=>n(e)))),this.init()}generateRandomCars(e){const t=["Tesla","Ford","Chevrolet","Toyota","Honda","Nissan","Jeep","Dodge","Mazda","Mercedes"],a=["Model S","Mustang","Corvette","Camry","Civic","Altima","Wrangler","Charger","MX-5","E-Class"],n=["Red","Blue","Green","Silver","Black","White","Gray","Yellow","Purple","Orange"],r=[];for(let c=0;c<e;c++){const e=`${t[Math.floor(Math.random()*t.length)]} ${a[Math.floor(Math.random()*a.length)]}`,c=n[Math.floor(Math.random()*n.length)];r.push({name:e,color:c})}return r}async startCarDriving(e){try{const t=new URLSearchParams;t.append("id",e.id),t.append("status",e.status);const a=await async function(e){let t=c;return e&&(t+=`?${e}`),fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).catch((e=>{throw console.error(`Error starting car: ${e}`),e}))}(t);500===a.status?(e.status="stopped",console.log(e.status),o(e)):(e.status="drive",console.log(e.status)),console.log(e.name,a)}catch(e){console.error("Error starting car driving!",e)}}moveCar(e){const t=document.querySelector(`#car_${e.id} .car-img`),a=t.getBoundingClientRect().width,n=t.querySelector("i"),r=a;let c=null;requestAnimationFrame((function t(s){c||(c=s);const o=s-c,i=e.velocity*a/e.distance,d=Math.min(i*o,r);n.style.marginLeft=`${d}px`,d>=r||requestAnimationFrame(t)}))}async startOrStopCarEngine(e){try{const t=new URLSearchParams;t.append("id",e.id),t.append("status",e.status),console.log(e.status);const{velocity:a,distance:n}=await async function(e){let t=c;return e&&(t+=`?${e}`),fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json"}}).then((e=>(console.log(e),e.json())))}(t);console.log(`${e.name} velocity: ${a} - distance: ${n}`),e.velocity=a,e.distance=n,"stopped"===e.status?this.stopCarAnimation(e):(e.status="drive",this.startCarDriving(e),this.moveCar(e))}catch(e){console.error("Error starting or stopping car engine!",e)}}};!async function(){await d.init()}();const l=document.getElementById("addCar"),m=l.querySelector(".modify_car_name"),u=l.querySelector(".modify_car_color");document.getElementById("addCarBtn").addEventListener("click",(()=>{const e={name:m.value,color:u.value};d.addCar(e)})),document.getElementById("generateBtn").addEventListener("click",(()=>{d.addRandomCars().then((()=>{h(),y()}))}));const p=document.getElementById("next_btn");p.addEventListener("click",(async()=>{d.nextPage(),await d.init(),y(),h()}));const g=document.getElementById("prev_btn");function h(){d.currentPage>1?g.disabled=!1:g.disabled=!0}function y(){const e=Math.ceil(d.totalCars/d.pageSize);d.currentPage<e?p.disabled=!1:p.disabled=!0}g.disabled=!0,g.addEventListener("click",(async()=>{d.previousPage(),await d.init(),h(),y()}))})();